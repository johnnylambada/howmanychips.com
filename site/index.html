<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Chip Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 1200px;
        }
        .input-section {
            background-color: #fff3cd;
            padding: 10px;
            margin-bottom: 20px;
        }
        .input-section label {
            margin-right: 10px;
        }
        .input-section input {
            margin-right: 10px;
            width: 60px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .summary {
            text-align: center;
            font-weight: bold;
        }
        .ad-section {
            margin: 20px 0;
            text-align: center;
            border: 1px dashed #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .chip-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .chip-row input {
            margin-right: 10px;
        }
        .remove-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background-color: #cc0000;
        }
        .standard-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 10px;
        }
        .standard-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Poker Chip Calculator</h1>
    <div class="input-section">
        <h3>Game Settings</h3>
        <label for="players">Players (2 or more):</label>
        <input type="number" id="players" min="2" value="2">
        <label for="buys">Buys (e.g., 1.5):</label>
        <input type="number" id="buys" step="0.1" value="1.5">

        <h3>Chip Types</h3>
        <div id="chip-types-container"></div>
        <button onclick="addChipType()">Add Chip Type</button>
        <button class="standard-btn" onclick="setStandardChips()">Standard</button>

        <button onclick="handleCalculateChips()" style="margin-top: 10px;">Calculate</button>
    </div>

    <div class="ad-section">
        <p>Advertisement Placeholder (Insert Ad Network Code Here)</p>
    </div>

    <h3>First Buy-in (Per Player)</h3>
    <table id="firstTable">
        <tr id="firstTableHeader">
            <th>Players</th>
            <th>Total Chips</th>
            <th>Total Value</th>
        </tr>
    </table>

    <h3>Last Buy-in (Per Player)</h3>
    <table id="lastTable">
        <tr id="lastTableHeader">
            <th>Players</th>
            <th>Total Chips</th>
            <th>Total Value</th>
        </tr>
    </table>

    <div id="totalChipsUsed" class="summary"></div>

    <script src="app.js"></script>
    <script>
        let chipTypes = [new Chip("white", 1, 0)];

        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
            return null;
        }

        function renderChipTypes() {
            const container = document.getElementById('chip-types-container');
            container.innerHTML = '';
            chipTypes.forEach((chip, index) => {
                const row = document.createElement('div');
                row.className = 'chip-row';
                row.innerHTML = `
                    <label>Name:</label>
                    <input type="text" value="${chip.name}" onchange="updateChipName(${index}, this.value)">
                    <label>Value:</label>
                    <input type="number" min="1" value="${chip.value}" onchange="updateChipValue(${index}, this.value)">
                    <label>Available:</label>
                    <input type="number" min="0" value="${chip.available}" onchange="updateChipAvailable(${index}, this.value)">
                    ${chipTypes.length > 1 ? `<button class="remove-btn" onclick="removeChipType(${index})">Remove</button>` : ''}
                `;
                container.appendChild(row);
            });
            updateTableHeaders();
        }

        function updateTableHeaders() {
            const firstHeader = document.getElementById('firstTableHeader');
            const lastHeader = document.getElementById('lastTableHeader');
            firstHeader.innerHTML = '<th>Players</th>';
            lastHeader.innerHTML = '<th>Players</th>';
            chipTypes.forEach(chip => {
                firstHeader.innerHTML += `<th>${chip.name}</th>`;
                lastHeader.innerHTML += `<th>${chip.name}</th>`;
            });
            firstHeader.innerHTML += '<th>Total Chips</th><th>Total Value</th>';
            lastHeader.innerHTML += '<th>Total Chips</th><th>Total Value</th>';
        }

        function updateTable(tableId, data, players) {
            const table = document.getElementById(tableId);
            while (table.rows.length > 1) table.deleteRow(1);
            const row = table.insertRow();
            row.insertCell().textContent = players;
            chipTypes.forEach(chip => {
                row.insertCell().textContent = data.chipsData[chip.name];
            });
            row.insertCell().textContent = data.totalChips;
            row.insertCell().textContent = `$${data.totalValue.toLocaleString()}`;
        }

        function handleCalculateChips() {
            const players = parseInt(document.getElementById('players').value);
            const buys = parseFloat(document.getElementById('buys').value);
            const result = calculateChips(players, buys, chipTypes);

            if (result.error) {
                alert(result.error);
                return;
            }

            updateTable('firstTable', result.firstBuy, players);
            updateTable('lastTable', result.lastBuy, players);
            document.getElementById('totalChipsUsed').textContent = `Total Chips Used: ${result.totalChipsUsed}`;
            setCookie('pokerChipState', JSON.stringify({ players, buys, chipTypes }), 30);
        }

        function addChipType() {
            chipTypes = addChipType(chipTypes);
            renderChipTypes();
        }

        function removeChipType(index) {
            chipTypes = removeChipType(chipTypes, index);
            renderChipTypes();
        }

        function updateChipName(index, name) {
            chipTypes = updateChipName(chipTypes, index, name);
            renderChipTypes();
        }

        function updateChipValue(index, value) {
            chipTypes = updateChipValue(chipTypes, index, value);
        }

        function updateChipAvailable(index, available) {
            chipTypes = updateChipAvailable(chipTypes, index, available);
        }

        function setStandardChips() {
            chipTypes = setStandardChips();
            renderChipTypes();
            handleCalculateChips();
        }

        function loadStateFromCookie() {
            const state = getCookie('pokerChipState');
            if (state) {
                const parsed = JSON.parse(state);
                document.getElementById('players').value = parsed.players;
                document.getElementById('buys').value = parsed.buys;
                chipTypes = parsed.chipTypes.map(c => new Chip(c.name, c.value, c.available));
                renderChipTypes();
                handleCalculateChips();
            } else {
                renderChipTypes();
                handleCalculateChips();
            }
        }

        loadStateFromCookie();
    </script>
</body>
</html>